{% extends "common/base.html" %}

{% block left %}
{% endblock %}

{% block main %}
<div class="main col-xs-offset-0 col-sm-offset-0 col-md-offset-0 col-xs-12 col-sm-12 col-md-12">
    {% block title_content_right %}
        <div class="row" id="title-content-right">
            {% block content %}
            <div class="main col-xs-offset-0 col-sm-offset-0 col-md-offset-0 col-xs-9 col-sm-9 col-md-9" id="content">
            <link rel="stylesheet" href="/static/plugins/editor.md/css/editormd.preview.css"/>
            <div class="row placeholders">
                <div id="editmdview">
                <textarea style="display:none;">{{ content_post_file }}</textarea>
                </div>
            </div>
            <script src="/static/plugins/editor.md/lib/marked.min.js"></script>
            <script src="/static/plugins/editor.md/lib/prettify.min.js"></script>
            <script src="/static/plugins/editor.md/lib/raphael.min.js"></script>
            <script src="/static/plugins/editor.md/lib/underscore.min.js"></script>
            <script src="/static/plugins/editor.md/lib/sequence-diagram.min.js"></script>
            <script src="/static/plugins/editor.md/lib/flowchart.min.js"></script>
            <script src="/static/plugins/editor.md/lib/jquery.flowchart.min.js"></script>
            <script src="/static/plugins/editor.md/editormd.js"></script>
            <script type="text/javascript">
                $(function() {
                    var testEditormdView = editormd.markdownToHTML("editmdview", {
                        htmlDecode      : "style,script,iframe",  // you can filter tags decode
                        toc             : true,
                        tocm            : true,    // Using [TOCM]
                        tocContainer    : "#toc-container", // 自定义 ToC 容器层
                        gfm             : false,
                        //tocDropdown     : true,
                        // markdownSourceCode : true, // 是否保留 Markdown 源码，即是否删除保存源码的 Textarea 标签
                        emoji           : true,
                        taskList        : true,
                        tex             : true,  // 默认不解析
                        flowChart       : true,  // 默认不解析
                        sequenceDiagram : true,  // 默认不解析
                    });
                });
            </script>
            </div>
            {% endblock %}
            {% block right %}
            <div class="main col-xs-offset-9 col-sm-offset-9 col-md-offset-9 col-xs-3 col-sm-3 col-md-3" id="right">
                <br/>
                <div class="panel">
                    <div class="panel-heading">
                        <span class="glyphicon glyphicon-list-alt"></span>
                        文章结构
                    </div>
                    <div class="markdown-body editormd-preview-container" id="toc-container">#toc-container</div>
                </div>
                <div class="panel">
                    <div class="panel-heading">
                        <span class="glyphicon glyphicon-flag"></span>
                        文章信息
                    </div>
                    <div class="list-group">
                        <a href="{% url 'app_blog' %}post/{{ content_post.user }}" class="list-group-item glyphicon glyphicon-user" title="作者">&nbsp;{{ content_post.user }}</a>
                        <a href="{% url 'app_blog' %}?active={{ content_post.post_class.slug }}" class="list-group-item glyphicon glyphicon-bookmark" title="分类">&nbsp;{{ content_post.post_class.name }}</a>
                        <a class="list-group-item glyphicon glyphicon-tag" title="关键词">&nbsp;{% for keyword in content_post.keywords %}{{ keyword }}{% endfor %}</a>
                        <a class="list-group-item glyphicon glyphicon-tags right-description" title="描述">&nbsp;{{ content_post.description }}</a>
                    </div>
                </div>
                {% if request.user.is_authenticated and  request.user == content_post.user %}
                <div class="panel">
                    <div class="panel-heading">
                        <span class="glyphicon glyphicon-edit"></span>
                        文章操作
                    </div>
                    <div class="list-group">
                        <a class="list-group-item glyphicon glyphicon-pencil" href="#myModal-edit" data-toggle="modal" data-target="#myModal-edit" style="color: blue;">编辑</a>
                        <a class="list-group-item glyphicon glyphicon-trash" href="#myModal-delete" data-toggle="modal" data-target="#myModal-delete" style="color: red;">删除</a>
                        <div>
                        {% for m in messages %}<h5>{{ m }}</h5>{% endfor %}
                        </div>
                    </div>
                </div>
                <div class="modal fade" id="myModal-edit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel-edit" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form id="modelformedit" method="post" enctype="multipart/form-data" >
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                    <h4 class="modal-title" id="myModalLabel-edit">文章信息</h4>
                                </div>
                                <label for="basic-url">文章域（slug）</label>
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon1">{% url 'app_blog' %}post/{{ request.user }}/</span>
                                    <input type="text" class="form-control" placeholder="必填项" aria-describedby="basic-addon1" value="{{ content_post.slug }}" readonly="true" name="slug"  maxlength="256">
                                </div>
                                <label for="basic-url">文章标题（title）</label>
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon2"></span>
                                    <input type="text" class="form-control" placeholder="必填项" aria-describedby="basic-addon2" value="{{ content_post.title }}" name="title" required maxlength="256">
                                </div>
                                <label for="basic-url">所属分类（post_class）</label>
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon3">请选择：</span>
                                    <select type="text" class="form-control" aria-describedby="basic-addon3" name="post_class" readonly="true" maxlength="256">
                                      <option>{{ content_post.post_class.name }}</option>
                                    </select>
                                </div>
                                <label for="basic-url">关键词（keywords）</label>
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon4"></span>
                                    <input type="text" class="form-control" placeholder="以半角分号区分多个关键字" aria-describedby="basic-addon4" value="{{ content_post.keywords }}" name="keywords"  maxlength="256">
                                </div>
                                <label for="basic-url">描述（description）</label>
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon5"></span>
                                    <input type="text" class="form-control" aria-describedby="basic-addon5" value="{{ content_post.description }}" name="description" >
                                </div>
                                <label for="basic-url">实体文件（content）</label>
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon6"></span>
                                    <input type="text" class="form-control" aria-describedby="basic-addon6" name="file" accept=".md" readonly="true" value="{{ content_post.content }}">
                                </div>
                                <input type="text" name="purpose" value="edit" style="display: none;">
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    <button type="submit" class="btn btn-primary" id="model-form-edit-btn">编辑</button>
                                </div>
                                {% csrf_token %}
                            </form>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
                <div class="modal fade" id="myModal-delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel-delete" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <form id="modelformdelete" method="post">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                    <h4 class="modal-title" id="myModalLabel-delete">文章信息</h4>
                                </div>
                                <label for="basic-url">文章域（slug）</label>
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon1">{% url 'app_blog' %}post/{{ request.user }}/</span>
                                    <input type="text" class="form-control" placeholder="必填项" aria-describedby="basic-addon1" value="{{ content_post.slug }}" readonly="true" name="slug"  maxlength="256">
                                </div>
                                <label for="basic-url">文章标题（title）</label>
                                <div class="input-group">
                                    <span class="input-group-addon" id="basic-addon2"></span>
                                    <input type="text" class="form-control" placeholder="必填项" aria-describedby="basic-addon2" value="{{ content_post.title }}" name="title" readonly="true" required maxlength="256">
                                </div>
                                <input type="text" name="purpose" value="delete" style="display: none;">
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                                    <button type="submit" class="btn btn-danger" {% if content_post.slug == 'index' %}disabled="true" {% endif %} id="model-form-delete-btn">删除</button>
                                </div>
                                {% csrf_token %}
                            </form>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
                {% endif %}
            </div>
            {% endblock %}
        </div>
    {% endblock %}
    {% block footer %}
        {% include "common/footer.html" %}
    {% endblock %}
</div>
{% endblock %}
