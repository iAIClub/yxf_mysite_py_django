{% extends "common/base.html" %}

{% block left %}
<div id="left" class="layui-side layui-bg-black">
    <div class="layui-side-scroll">
        <ul class="layui-nav layui-nav-tree">
            <li class="layui-nav-item layui-nav-itemed">
                <a href="javascript:;">网站设置</a>
                <dl class="layui-nav-child">
                    <dd>
                        <a href="{% url 'settings' %}?status=1">实时网站状态</a>
                    </dd>
                    <dd>
                        <a href="{% url 'settings' %}?history=1">清空历史记录</a>
                    </dd>
                    <dd>
                        <a href="{% url 'settings' %}?doc=1">更新文档内容</a>
                    </dd>
                    <dd>
                        <a href="{% url 'settings' %}?data=1">操作网站数据</a>
                    </dd>
                    <dd>
                        <a href="{% url 'settings' %}?set=1">网站配置选项</a>
                    </dd>
                </dl>
            </li>
        </ul>
    </div>
</div>
{% endblock %}

{% block content %}
<div id="content" class="layui-col-xs10 layui-col-sm10 layui-col-md10">
    <style>
    .layui-card{
        padding:10px;
    }
    </style>
{% if arg_status %}
    <fieldset class="layui-elem-field layui-field-title">
        <legend>实时网站状态</legend>
    </fieldset>
    <div class="layui-card">

    </div>
{% elif arg_history %}
    <fieldset class="layui-elem-field layui-field-title">
        <legend>清空历史记录</legend>
    </fieldset>
    <div class="layui-card">

    </div>
{% elif arg_doc %}
    <fieldset class="layui-elem-field layui-field-title">
        <legend>更新文档内容</legend>
    </fieldset>
    <div class="layui-card">
        <form class="layui-form layui-form-pane" method="post" enctype="multipart/form-data" action="">
            {% csrf_token %}
            <div class="layui-form-item pane">
                <label class="layui-form-label" >选择压缩包</label>
                <div class="layui-input-block">
                    <input class="layui-input" type="text" name="purpose" value="update_doc" style="display: none;">
                    <input class="layui-input" type="file" multiple name="upload-file" id="file-upload" accept="application/zip,.zip" required>
                </div>
            </div>
            <h3>请把线下整理好的docx文档以文件夹为单位打包成zip格式。</h3>
            <h3>上传后网站会自动部署，文件夹名映射为栏目slug，文档名映射为文档slug。</h3>
            <hr>
            <div class="layui-form-item pane">
                <div class="layui-input-block">
                    <button class="layui-btn layui-btn-disabled" type="submit" id="submit">上传</button>
                    <button class="layui-btn layui-btn-primary" id="clean">清空</button>
                </div>
            </div>
        </form>
        <table class="layui-table">
            <tbody id="file-list">
            </tbody>
        </table>
        <table class="layui-table">
            <thead>
                <tr>
                    <th>文档栏目</th>
                    <th>文档名称</th>
                </tr>
            </thead>
            <tbody>
                {% for item in doc_list %}
                <tr class="list-group-item">
                    <td>{{ item.column }}</td>
                    <td title="于 {{ item.update_time }} 上传">{{ item.title }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <script type="text/javascript">
        $(function(){
            //message
            layui.use(['layer'], function(){
                var layer = layui.layer;
                {% for m in messages %}layer.msg("{{ m }}");{% endfor %}
            });

            //clean
            $("#clean").click(function(){
                $("#page-message").empty();
                $("#file-upload").val("");
                $("#file-list").empty();
                $("#submit").addClass("layui-btn-disabled");
            });

            //file upload
            $("#file-upload").change(function(){
                $("#submit").removeClass("layui-btn-disabled");
                var fp = $("#file-upload");
                var lg = fp[0].files.length; // get length
                var items = fp[0].files;
                var fragment = "";
                var size = 0;
                if (lg > 0) {
                    for (var i = 0; i < lg; i++) {
                        var fileName = items[i].name; // get file name
                        var fileSize = items[i].size; // get file size
                        var fileType = items[i].type; // get file type
                        fragment += "<tr><td>" + fileName + "<p style='float:right;'>"+ fileSize + " bytes - Type: " + fileType + "</p></td></tr>";
                        size += fileSize;
                        if (size > 64000000){
                            layer.msg("文件大小超限！最高一次性上传64M！");
                            $("#submit").addClass("layui-btn-disabled");
                        }
                    }
                    $("#file-list").append(fragment);
                }
            });
        });
        </script>
    </div>
{% elif arg_data %}
    <fieldset class="layui-elem-field layui-field-title">
        <legend>操作网站数据</legend>
    </fieldset>
    <div class="layui-card">

    </div>
{% elif arg_set %}
    <fieldset class="layui-elem-field layui-field-title">
        <legend>网站配置选项</legend>
    </fieldset>
    <div class="layui-card">

    </div>
{% endif %}
</div>
{% endblock %}

{% block right %}
{% endblock %}
