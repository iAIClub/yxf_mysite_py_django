<div id="editmd">
<!-- <textarea class="editormd-markdown-textarea" name="editmd-markdown-doc" style="display: none;">.md code</textarea> --><!-- 可接收后台数据 -->
<!-- <textarea class="editormd-html-textarea" name="editmd-html-code" style="display: none;">.html code</textarea> --><!-- 编辑器自动生成 -->
<textarea style="display:none;"></textarea>
</div>
<script type="text/javascript">
$(function(){

        function GetQueryString(name)
        {
             var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
             var r = window.location.search.substr(1).match(reg);//search,查询？后面的参数，并匹配正则
             if(r!=null){
                return decodeURI(r[2]);//编码解码是相对的，没有固定方向。实际的URI是%+数字的通用转义形式，要想让程序代码识别，需要decodeURI()
             }else{
                return null;
             }
        };

        $(function(){
                $("#navbar").removeClass("navbar-fixed-top");
                $("body").css("padding-top",0);
        });

        var fileurl = "{% url 'app_tutorial_editmd' %}?column="+GetQueryString("column")+"&slug="+GetQueryString("slug")+"&title="+GetQueryString("title")+"&getfile=True";
        $.get(fileurl, function(mdfile){/*load .md file*/
            var editor = editormd("editmd",{ /*editor id*/

                //基础设置
                id:                 "editmd",//编辑器ID
                path:               "/static/plugins/editor.md/lib/",//后端路径
                width:              "90vw",//宽度
                height:             "85vh",//高度
                toolbarAutoFixed:   false,//编辑器工具栏fixed顶部
                htmlDecode :        "style,script,iframe|on*",//解析html代码，可在编辑器里预览效果，过滤特定标签
                markdown :          mdfile,//预加载文档mdfile，只在通过文件打开编辑器时使用
                //tocContainer:     "#custom-toc-container", //自定义ToC目录容器

                //编辑器设置
                codeFold :          true,//代码折叠
                searchReplace :     true,//搜索替换功能
                readOnly :          false,//只读
                styleActiveLine :   true,//动态显示焦点行
                watch  :            true,//预览
                lineNumbers :       true,//行数
                theme:              "default",//容器主题
                previewTheme:       "default",//预览区主题
                editorTheme:        "default",//代码区主题

                //扩展md语法设置
                atLink    :         true, //@link
                emailLink :         true, //@email
                taskList :          true,//任务列表
                toc :               true,//列表式目录
                tocm :              true,//按钮式目录
                tex :               true,//科学公式
                flowChart :         true,//流程图
                sequenceDiagram :   true,//序列图
                emoji :             true,//表情
                pageBreak :         false,//分页，主要用于打印

                //输出html代码区
                //<textarea class="editormd-html-textarea" name="editmd-html-code">
                saveHTMLToTextarea: true,

                //图片上传
                imageUpload :       true,//图片上传
                imageFormats :      ["jpg", "jpeg", "gif", "png", "bmp", "webp"],//图片格式
                imageUploadURL :    "{% url 'app_tutorial_editmd' %}",//图片上传后端处理程序

                //自定义工具栏
                toolbarIcons : function() {
                    return ["undo","redo","|","bold","del","italic","quote","ucwords","uppercase","lowercase","|","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","|","link","reference-link","image","code","preformatted-text","code-block","table","datetime","emoji","html-entities","pagebreak","|","goto-line","watch","preview","fullscreen","clear","search","|","help","info","|","savepage","outputmdfile","outputhtmlfile","|","returnto"];
                },
                toolbarIconsClass : {//指定一个FontAawsome的图标类
                    savepage:"fa-floppy-o",
                    outputmdfile:"fa-files-o",
                    outputhtmlfile:"fa-files-o",
                    returnto:"fa-times",
                },
                lang : {// 提示文本
                    toolbar: {
                        savepage:"保存页面",
                        outputmdfile:"导出md文件",
                        outputhtmlfile:"导出html文件",
                        returnto:"关闭编辑器并返回",
                    },
                },
                toolbarHandlers : {//工具按钮事件
                    savepage: function(){
                          $.ajax({
                            url: "{% url 'app_tutorial_editmd' %}",
                            type:"POST",
                            timeouut:10000,
                            data:{
                              "purpose":"save_file",
                              "username":"{{ request.user }}",
                              "userpath":'',
                              "filename":'',
                              "csrfmiddlewaretoken":"{{ csrf_token }}"
                            },
                            success:function (data) {
                              var parsedJson = eval(data);
                              if(parsedJson.status=="ok"){window.location.reload();}
                            }
                          });
                    },
                    outputmdfile: function(){

                    },
                    outputhtmlfile: function(){

                    },
                    returnto: function(){

                    },
                },
            });
        });
});
</script>